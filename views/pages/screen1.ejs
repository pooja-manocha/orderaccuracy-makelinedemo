<!DOCTYPE html>
<html lang="en">

<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> 
	<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
	<script src="//js.leapmotion.com/leap-0.6.3.js"></script>

	<link rel = "stylesheet" type = "text/css" href = "//localhost:3001/css/style.css" />
		
	<script src="/socket.io/socket.io.js"></script>
	<script>

		$(document).ready(function () {
		var socket = io();
		socket.on('broadcast', function (data) {
				if(data.orderId!=undefined){
					console.log("Ordername -- "+ data.orderName + " Screen -- "+ data.screenName +" round -- "+ data.subScreen+ "started---------->>>"+ data);			
						$('#img1').attr('src',data.imageUrl[0]);
						$('#img2').attr('src',data.imageUrl[1]);
						$('#img3').attr('src',data.imageUrl[2]);					
					$('#iconImages').attr('src', data.imagePath+'/glossy-green-icon.png');
					$('#header-order-number').html(" 14\" "+ data.orderName +"<span class='orderidtext'> Order 00100300"+data.orderId+" </span>");
					$('#footer-order-number').html("Next UP: <span class='footerorderbigtxt'> 14\" "+data.orderName +" </span><span class='footerordersmalltxt'> Order 00100300"+data.orderId+"</span> ");
					$('#orderId').html(data.orderId);
					$('#screenName').html("Screen"+data.screenName);
					$("#screen1").css({"background-color":"green", "color": "white"});
					var pizzaTimer = new Timer();
					pizzaTimer.stop();
					pizzaTimer.start({precision: 'seconds',startValues: {seconds: 0}});
					pizzaTimer.addEventListener('secondsUpdated', function (e) {
						$('#customTimer').html(pizzaTimer.getTimeValues().toString());
						if(pizzaTimer.getTimeValues().seconds >= data.imageRotationTimer && pizzaTimer.getTimeValues().seconds < 2*(data.imageRotationTimer))
						{
							$('#iconImages').attr('src', data.imagePath+'/yellow-circle-icon.png');
						}
						if(pizzaTimer.getTimeValues().seconds >= 2*(data.imageRotationTimer) && pizzaTimer.getTimeValues().seconds <= 3*(data.imageRotationTimer))
						{
							$('#iconImages').attr('src', data.imagePath+'/red-circle-icon.png');
						}
					});

					var timerInstance = new Timer();					
					timerInstance.start();
					timerInstance.addEventListener('secondsUpdated', function (e) {
						if(timerInstance.getTimeValues().toString()=="00:00:01")
						{
							$('#img2').fadeOut();
							$('#img3').fadeOut();
							$('#img1').fadeIn();
						}
						else if(timerInstance.getTimeValues().toString()=="00:00:04")
						{
							$('#img1').css('display','inline');
							$('#img1').attr('src',data.imageUrl[3]);
							$('#img2').fadeIn();
						}else if(timerInstance.getTimeValues().toString()=="00:00:07")
						{
							//$('#img2').fadeOut();
							$('#img3').fadeIn();
							$('#img1').css('display','inline');
							$('#img2').css('display','inline');
							$('#img1').attr('src',data.imageUrl[3]);
							$('#img2').attr('src',data.imageUrl[4]);							
						}
						else if(timerInstance.getTimeValues().toString()=="00:00:10"){
							$('#img1').css('display','inline');
							$('#img2').css('display','inline');
							$('#img1').attr('src',data.imageUrl[3]);
							$('#img2').attr('src',data.imageUrl[4]);							
							$('#img3').css('display','inline');
							$('#img3').attr('src',data.imageUrl[5]);
							timerInstance.stop();
						}
					});

					
					$("#screenContent").show();
					$(document).keydown(function(e) {
					var userInput = e.target.value;
						if(e.keyCode== 32)
						{
							alert("There is no screen behind");
						}
						if(e.keyCode==13)
						{	// please send 2 more index isRotation and  subScreen
							socket.emit("getNextScreen",data);
							data.pizzaTime = pizzaTimer.getTimeValues().toString();
							data.isRotation = data.subScreens["screen2"].isRotation;
							data.subScreen =  0;							
							$("#screen1").css({"background-color":"red", "color": "white"})
							data.pizzaTime = pizzaTimer.getTimeValues().seconds;
							pizzaTimer.stop();
						}
					});
					
					$("#screen1").click(function(){
						
						$("#screen1").css({"background-color":"red", "color": "white"})
						data.pizzaTime = pizzaTimer.getTimeValues().seconds;
						// please send 2 more index isRotation and  subScreen						
						console.log("data object for subscreens -->", data.subScreens["screen2"].isRotation);
						data.isRotation = data.subScreens["screen2"].isRotation;
						data.subScreen = 0;
						console.log("data object ----> ", data);
						console.log("on Screen 2-------> data.isRotation-->", data.isRotation);
						console.log("on Screen 2-------> data.subScreen-->", data.subScreen);
						pizzaTimer.stop();
						socket.emit("getNextScreen",data);
					});				
				}else{
					$("#screenContent").hide();
				}
				
				

				window.controller = new Leap.Controller({enableGestures: true});
				var swiper = controller.gesture('swipe');
				if (swiper.state == "stop") {
					console.log('swiper-------------------------------------------');
					//getNextOrder();
				}
			});
		});

		

	</script>
	<% include ../partials/head %>  
	
</head>

<body class="container" id="container">
	<header>
		<% include ../partials/header %>
	</header>
	<main>
			<div class="form-group screenContent" Id="screenContent" style="display: none"> 				
				<div id="content">
					<div class="container-fluid align-center">
						<img id="img1" class="img-responsive float-left screen-img" src="" alt="pizza" > 
						<img id="img2" class="img-responsive float-left screen-img" src="" alt="pizza" > 
						<img id="img3" class="img-responsive float-left screen-img" src="" alt="pizza" > 
					</div>
				</div>
				<div class="row"> 
					<!--button class="btn btn-default" id="screen11" style="margin-left: 500px">MYO Left Swap</button-->
					<button class="btn btn-default float-right" id="screen1" style="margin-right: 50px">MYO Right Swap</button>
					<p>
						Order Id : <span id="orderId"></span>
						Screen Name : <span id="screenName"></span>						
					</p>
				</div>				
			</div>
	</main>
	<footer>
		<% include ../partials/footer %>
	</footer>
</body>
</html>